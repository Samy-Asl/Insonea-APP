<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#320763">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Insonea">
    <link rel="apple-touch-icon" href="icon-192 2.png">
    <meta name="description" content="Insonea - DÃ©tecteur de niveaux sonores pour protÃ©ger votre audition">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="INsonea-logo 2.png">
    <link type="stylesheet" href="styles.css">
    <title>Insonea - DÃ©tecteur de DÃ©cibels</title>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo-section">
                <div class="logo">
                    <img src="INsonea 2.png" alt="Logo Insonea">
                </div>
            </div>
            <h1>IN<span>sonea</span></h1>
            <p>DÃ©tecteur de niveaux sonores</p>
        </header>

        <div class="install-prompt" id="installPrompt">
            <p>ğŸ“± Installer comme app ?</p>
            <div style="display: flex; gap: 8px;">
                <button class="install-btn install-btn-primary" onclick="installPWA()">âœ“ Installer</button>
                <button class="install-btn install-btn-secondary" onclick="dismissInstall()">âœ• Plus tard</button>
            </div>
        </div>

        <div class="permission-prompt" id="permissionPrompt">
            <p>âš ï¸ AccÃ¨s au microphone requis. Cliquez sur "DÃ©marrer".</p>
        </div>

        <div class="stats-banner">
            <div class="stat-item">
                <div class="stat-label">ğŸ”” DÃ©passements</div>
                <div class="stat-value" id="exceedanceCount">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">â±ï¸ DurÃ©e</div>
                <div class="stat-value" id="exceedanceDuration">0s</div>
            </div>
        </div>

        <div class="main-card">
            <div class="meter-label">NIVEAU SONORE</div>
            <div class="db-display" id="dbValue">0</div>
            <div class="db-unit">dB</div>
            
            <div class="visualization" id="visualization"></div>

            <div class="status-box">
                <div class="status-indicator safe" id="statusIndicator"></div>
                <div class="status-text" id="statusLabel">En attente</div>
            </div>
        </div>

        <div class="controls">
            <button class="btn btn-start" id="startBtn" onclick="startMonitoring()">â–¶ï¸ DÃ©marrer</button>
            <button class="btn btn-stop" id="stopBtn" onclick="stopMonitoring()" disabled>â¹ï¸ ArrÃªter</button>
            <button class="btn btn-stop" id="bilanBtn" onclick="generateBilan()" disabled>ğŸ“Š Bilan</button>
        </div>

        <div class="info-grid">
            <div class="info-box">
                <div class="label">Pic</div>
                <div class="value" id="peakValue">0 dB</div>
            </div>
            <div class="info-box">
                <div class="label">Moyenne</div>
                <div class="value" id="averageValue">0 dB</div>
            </div>
        </div>

        <div class="settings-toggle" onclick="toggleSettings()">
            <button class="settings-toggle-btn">âš™ï¸ Configuration </button>
        </div>

        <div class="settings-section" id="settingsSection">
            <h3>âš™ï¸ Configuration</h3>
            <div class="input-group">
                <label for="warningThreshold">Seuil Alerte (dB)</label>
                <input type="number" id="warningThreshold" value="85" min="60" max="130" step="1">
            </div>
            <div class="input-group">
                <label for="dangerThreshold">Seuil Danger (dB)</label>
                <input type="number" id="dangerThreshold" value="100" min="60" max="130" step="1">
            </div>
            <div class="input-group">
                <label for="safeThreshold">Seuil Safe (dB)</label>
                <input type="number" id="safeThreshold" value="65" min="30" max="120" step="1">
            </div>
            <div class="input-group">
                <label for="emailInput">Email Rapport</label>
                <input type="email" id="emailInput" placeholder="email@exemple.com">
            </div>

            <div class="threshold-display">
                <div class="threshold-box">
                    <div class="label safe">ğŸŸ¢ Safe</div>
                    <div class="value safe" id="thresholdSafe">85</div>
                </div>
                <div class="threshold-box">
                    <div class="label warn">ğŸŸ  Alerte</div>
                    <div class="value warn" id="thresholdWarning">85</div>
                </div>
                <div class="threshold-box">
                    <div class="label danger">ğŸ”´ Danger</div>
                    <div class="value danger" id="thresholdDanger">100</div>
                </div>
            </div>
        </div>

        <div class="log-section" id="logSection">
            <div class="log-item">En attente de dÃ©marrage...</div>
        </div>
            <div class="bilan-section" id="bilanSection">
        <h3>ğŸ“Š Bilan du monitoring</h3>

        <div class="bilan-grid">
            <div class="bilan-item">
                <span>â±ï¸ DurÃ©e</span>
                <strong id="bilanDuration">â€“</strong>
            </div>
            <div class="bilan-item">
                <span>ğŸ“ˆ Moyenne</span>
                <strong id="bilanAverage">â€“</strong>
            </div>
            <div class="bilan-item">
                <span>ğŸš€ Pic</span>
                <strong id="bilanPeak">â€“</strong>
            </div>
            <div class="bilan-item">
                <span>ğŸ”” DÃ©passements</span>
                <strong id="bilanExceedances">â€“</strong>
            </div>
            <div class="bilan-item full">
                <span>ğŸ§  Verdict</span>
                <strong id="bilanVerdict">â€“</strong>
            </div>
        </div>
    </div>
    </div>
    <script src="script.js"></script>
    <script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('sw.js')
                .then(reg => console.log('SW enregistrÃ©', reg))
                .catch(err => console.log('SW erreur', err));
        });
    }
    </script>
    <script src="app.js"></script>
</body>
</html>
